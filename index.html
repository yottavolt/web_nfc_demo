<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Temperature Dashboard</title>
  <style>
    :root {
      --bg-dark: #121212;
      --box-dark: #1e1e1e;
      --track: #333;
      --text-light: #e0e0e0;
    }

    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      background: var(--bg-dark);
      color: var(--text-light);
    }

    /* Hamburger */
    .hamburger {
      position: fixed;
      top: 1rem;
      left: 1rem;
      font-size: 2rem;
      background: none;
      border: none;
      color: var(--text-light);
      cursor: pointer;
      z-index: 1001;
    }

#sidebar {
  position: fixed;
  top: 0;
  left: 0; /* Always anchored to the left edge */
  width: 240px;
  height: 100%;
  background: var(--box-dark);
  padding: 5rem 1rem 2rem 1rem;
  box-shadow: 2px 0 10px rgba(0,0,0,0.35);
  transition: transform 0.3s ease, opacity 0.3s ease;
  transform: translateX(-240px); /* Slide out by its own width */
  opacity: 0;
  pointer-events: none;
  z-index: 1000;
}

#sidebar.open {
  transform: translateX(0); /* Slide in fully */
  opacity: 1;
  pointer-events: auto;
}

    #sidebar.open {
    transform: translateX(0);
    opacity: 1;
    pointer-events: auto;
    }

    #sidebar button {
      display: block;
      width: 100%;
      text-align: left;
      background: #333;
      color: var(--text-light);
      border: none;
      padding: 0.6rem 1rem;
      margin-bottom: 1rem;
      cursor: pointer;
      border-radius: 6px;
    }

    /* Main sections */
    .section {
      display: none;
      padding: 2rem;
      max-width: 960px;
      margin: auto;
    }

    .active { display: block; }

    /* Gauges layout */
    .gauges-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 1rem;
      justify-items: center;
    }

    /* Ensure at least 2 gauges on small screens */
    @media (max-width: 600px) {
      .gauges-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .gauge-label {
      text-align: center;
      margin-bottom: 0.5rem;
      font-size: 1rem;
      font-weight: 600;
    }

    svg.circle-bar { display: block; }

    .track, .progress {
      fill: none;
      stroke-linecap: round;
    }

    .track { stroke: var(--track); stroke-width: 15; }
    .progress { stroke-width: 15; }

    text.tempValue {
      font-size: 36px;
      font-weight: bold;
      text-anchor: middle;
      dominant-baseline: middle;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    label {
      margin-bottom: 0.5rem;
      font-weight: 600;
    }

    input, button, select {
      padding: 0.6rem;
      border-radius: 6px;
      border: 1px solid #444;
      background: #1e1e1e;
      color: #e0e0e0;
    }

    button#writeBtn {
      margin-top: 2rem;
      padding: 0.8rem 1.2rem;
      font-size: 1rem;
      background: #444;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    button#writeBtn:hover { background: #666; }
  </style>
</head>
<body>
  <!-- Hamburger -->
  <button id="menu-toggle" class="hamburger" aria-label="Open menu">&#9776;</button>

  <!-- Sidebar -->
  <aside id="sidebar" aria-label="Sidebar navigation">
    <button onclick="showSection('home')">Home</button>
    <button onclick="showSection('config')">Config</button>
    <button onclick="showSection('color')">Color Picker</button>
  </aside>

  <!-- Pages -->
  <div id="home" class="section active">
    <h2>Room Temperatures</h2>
    <div class="gauges-grid" id="gaugesContainer"></div>
  </div>

  <div id="config" class="section">
    <h2>Configure Temperatures & Write to NFC</h2>
    <div class="form-grid" id="formContainer"></div>
    <div style="text-align:center">
      <button id="writeBtn">Write to NFC</button>
    </div>
  </div>

  <div id="color" class="section">
    <h2>Color Picker</h2>
    <div style="text-align:center">
      <input type="color" id="colorInput" value="#00aaff" />
      <br><br>
      <button id="colorOkBtn">OK</button>
    </div>
  </div>

  <script>
    const MIN = -20, MAX = 50, MID = 15;
    const labels = ['Living Room', 'Kitchen', 'Bedroom', 'Office', 'Garage', 'Basement'];

    // Sidebar toggle
    document.getElementById('menu-toggle').addEventListener('click', () => {
      document.getElementById('sidebar').classList.toggle('open');
    });

    // Page switching
    function showSection(id) {
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      document.getElementById('sidebar').classList.remove('open');
    }

    function colorForTemp(t) {
      if (!Number.isFinite(t)) return '#888';
      const hue = t <= MID
        ? 210 + (50 - 210) * ((t - MIN) / (MID - MIN))
        : 50 + (33 - 50) * ((t - MID) / (MAX - MID));
      return `hsl(${hue}, 100%, 50%)`;
    }

    function getTempsFromURL() {
      const params = new URLSearchParams(window.location.search);
      return Array.from({ length: 6 }, (_, i) => {
        const temp = parseFloat(params.get(`temp${i + 1}`));
        return Number.isFinite(temp) ? temp : null;
      });
    }

    function createGauge(temp, label) {
      const arcPath = "M 43.431,156.569 A 80 80 0 1 1 156.569,156.569";
      const dummy = document.createElementNS("http://www.w3.org/2000/svg", "path");
      dummy.setAttribute("d", arcPath);
      const arcLength = dummy.getTotalLength();
      const offset = Number.isFinite(temp) ? arcLength * (1 - (temp - MIN) / (MAX - MIN)) : arcLength;
      const color = colorForTemp(temp);
      const tempVal = Number.isFinite(temp) ? `${temp}°C` : '--';

      const wrapper = document.createElement("div");
      wrapper.innerHTML = `
        <div class="gauge-label">${label}</div>
        <svg class="circle-bar" width="240" height="240" viewBox="0 0 200 200">
          <path class="track" d="${arcPath}" stroke-width="15" />
          <path class="progress" d="${arcPath}" stroke="${color}" stroke-width="15"
            stroke-dasharray="${arcLength}" stroke-dashoffset="${offset}" />
          <text class="tempValue" x="100" y="100" fill="${color}">${tempVal}</text>
        </svg>
      `;
      return wrapper;
    }

    function initHome() {
      const container = document.getElementById('gaugesContainer');
      const temps = getTempsFromURL();
      container.innerHTML = '';
      temps.forEach((temp, i) => {
        container.appendChild(createGauge(temp, labels[i]));
      });
    }

    function initConfig() {
      const container = document.getElementById('formContainer');
      container.innerHTML = '';
      labels.forEach((label, i) => {
        const group = document.createElement('div');
        group.className = 'form-group';
        group.innerHTML = `
          <label for="temp${i}">${label}</label>
          <input type="number" id="temp${i}" placeholder="Enter °C" />
        `;
        container.appendChild(group);
      });
    }

    async function writeToNFC() {
      try {
        const temps = labels.map((_, i) => {
          const val = parseFloat(document.getElementById(`temp${i}`).value);
          return Number.isFinite(val) ? val : '';
        });

        const url = `https://yottavolt.github.io/web_nfc_demo/?${
          temps.map((t, i) => `temp${i + 1}=${encodeURIComponent(t)}`).join('&')
        }`;

        if (!('NDEFReader' in window)) {
          alert('Web NFC unsupported. Use a compatible device and HTTPS.');
          return;
        }

        const ndef = new NDEFReader();
        await ndef.write({ records: [{ recordType: "url", data: url }] });

        const btn = document.getElementById('writeBtn');
        btn.textContent = '✅ NFC Tag Written!';
        setTimeout(() => btn.textContent = 'Write to NFC', 2000);
      } catch (err) {
        alert('NFC write failed. Make sure your device supports Web NFC and you are using HTTPS.');
        console.error(err);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      initHome();
      initConfig();
      document.getElementById('writeBtn').addEventListener('click', writeToNFC);
    });
  </script>
</body>
</html>
